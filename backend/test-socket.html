<!DOCTYPE html>
<html>
<head>
    <title>Test Socket.io</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Test Socket.io - Academias Rivales</h1>
    <div id="status"></div>
    <button onclick="connectMain()">Conectar Principal</button>
    <button onclick="connectGame()">Conectar /game</button>
    <button onclick="connectAcademy()">Conectar /academy</button>
    <button onclick="connectChat()">Conectar /chat</button>
    <button onclick="testJoinQueue()">Test: Join Queue</button>
    <button onclick="testSendMessage()">Test: Send Message</button>
    <div id="logs" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: scroll;"></div>

    <script>
        const TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI4MWJmYWYyOC00ZWFiLTRjYWItYTU2YS0wNTBlMjA4ZTc4ZTUiLCJ1c2VybmFtZSI6InRlc3R1c2VyIiwiYWNhZGVteUlkIjpudWxsLCJpYXQiOjE3NTkyOTExMDIsImV4cCI6MTc1OTg5NTkwMn0.PvY6V779_YfdaUW8u1HHf6tYDS3XyE8rcyB3fhB0rUw';

        let mainSocket, gameSocket, academySocket, chatSocket;

        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `[${time}] ${message}<br>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function connectMain() {
            mainSocket = io('http://localhost:5000', {
                auth: { token: TOKEN }
            });

            mainSocket.on('connect', () => {
                log('‚úÖ Conectado al namespace principal');
                document.getElementById('status').textContent = 'Conectado a /';
            });

            mainSocket.on('connect_error', (error) => {
                log('‚ùå Error en conexi√≥n principal: ' + error.message);
            });

            mainSocket.on('disconnect', () => {
                log('üî¥ Desconectado del namespace principal');
            });
        }

        function connectGame() {
            gameSocket = io('http://localhost:5000/game', {
                auth: { token: TOKEN }
            });

            gameSocket.on('connect', () => {
                log('üéÆ Conectado a /game');
            });

            gameSocket.on('game:queue-joined', (data) => {
                log('üì© Queue joined: ' + JSON.stringify(data));
            });

            gameSocket.on('connect_error', (error) => {
                log('‚ùå Error en /game: ' + error.message);
            });
        }

        function connectAcademy() {
            academySocket = io('http://localhost:5000/academy', {
                auth: { token: TOKEN }
            });

            academySocket.on('connect', () => {
                log('üè∞ Conectado a /academy');
            });

            academySocket.on('academy:resources-update', (data) => {
                log('üíé Recursos: ' + JSON.stringify(data));
            });

            academySocket.on('connect_error', (error) => {
                log('‚ùå Error en /academy: ' + error.message);
            });
        }

        function connectChat() {
            chatSocket = io('http://localhost:5000/chat', {
                auth: { token: TOKEN }
            });

            chatSocket.on('connect', () => {
                log('üí¨ Conectado a /chat');
            });

            chatSocket.on('chat:new-message', (data) => {
                log('üí¨ Mensaje: ' + data.username + ': ' + data.message);
            });

            chatSocket.on('connect_error', (error) => {
                log('‚ùå Error en /chat: ' + error.message);
            });
        }

        function testJoinQueue() {
            if (!gameSocket) {
                log('‚ö†Ô∏è Primero conecta a /game');
                return;
            }
            gameSocket.emit('game:join-queue', { gameType: 'trivia' });
            log('üì§ Enviado: join-queue (trivia)');
        }

        function testSendMessage() {
            if (!chatSocket) {
                log('‚ö†Ô∏è Primero conecta a /chat');
                return;
            }
            chatSocket.emit('chat:send-message', { message: 'Hola desde el test!' });
            log('üì§ Enviado mensaje de chat');
        }
    </script>
</body>
</html>
